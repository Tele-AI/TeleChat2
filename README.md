<div align="center">
<h1>
  æ˜Ÿè¾°è¯­ä¹‰å¤§æ¨¡å‹-TeleChat2
</h1>
</div>


<p align="center">
	ğŸ¤— <a href="https://huggingface.co/Tele-AI" target="_blank">Hugging Face</a> â€¢ ğŸ¤– <a href="https://modelscope.cn/organization/TeleAI" target="_blank">ModelScope</a> â€¢ ğŸ” <a href="https://gitee.com/mindspore/mindformers/tree/dev/research/telechat" target="_blank">MindSpore</a> â€¢ ğŸ¾ <a href="https://gitee.com/Tele-AI/tele-chat" target="_blank">gitee</a>ï¸ â€¢ ğŸ’¬ <a href="https://github.com/Tele-AI/Telechat/blob/master/images/wechat.jpg" target="_blank">WeChat</a>
</p>

# ç›®å½•

- [æ¨¡å‹ä»‹ç»](#æ¨¡å‹ä»‹ç»)
- [æ•ˆæœè¯„æµ‹](#æ•ˆæœè¯„æµ‹)
- [æ¨¡å‹æ¨ç†å’Œéƒ¨ç½²](#æ¨¡å‹æ¨ç†å’Œéƒ¨ç½²)
- [æ¨¡å‹å¾®è°ƒ](#æ¨¡å‹å¾®è°ƒ)
- [å£°æ˜ã€åè®®ã€å¼•ç”¨](#å£°æ˜åè®®å¼•ç”¨)

# æœ€æ–°åŠ¨æ€

- 2024.9.20 å¼€æºTeleChat2-115Bæ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ˜¯**é¦–ä¸ªå®Œå…¨å›½äº§ç®—åŠ›è®­ç»ƒå¹¶å¼€æºçš„åƒäº¿å‚æ•°æ¨¡å‹**ã€‚

# æ¨¡å‹ä»‹ç»

### æ˜Ÿè¾°è¯­ä¹‰å¤§æ¨¡å‹-TeleChat2

- æ˜Ÿè¾°è¯­ä¹‰å¤§æ¨¡å‹**TeleChat2**æ˜¯ç”±ä¸­å›½ç”µä¿¡äººå·¥æ™ºèƒ½ç ”ç©¶é™¢ç ”å‘è®­ç»ƒçš„å¤§è¯­è¨€æ¨¡å‹ï¼Œè¯¥ç³»åˆ—æ¨¡å‹**å®Œå…¨åŸºäºå›½äº§ç®—åŠ›**è®­ç»ƒã€‚
- æœ¬æ¬¡å¼€æº**TeleChat2-115B**æ¨¡å‹é‡‡ç”¨10ä¸‡äº¿ Tokensä¸­è‹±æ–‡é«˜è´¨é‡è¯­æ–™è¿›è¡Œè®­ç»ƒï¼ŒåŒæ­¥å¼€æºå¯¹è¯æ¨¡å‹**TeleChat2-115B**çš„å¤šæ ¼å¼ã€å¤šå¹³å°æƒé‡æ–‡ä»¶ã€‚
- **TeleChat2**åœ¨è®­ç»ƒæ•°æ®ã€è®­ç»ƒæ–¹æ³•ç­‰æ–¹é¢è¿›è¡Œäº†æ”¹è¿›ï¼Œåœ¨é€šç”¨é—®ç­”å’ŒçŸ¥è¯†ç±»ã€ä»£ç ç±»ã€æ•°å­¦ç±»æ¦œå•ä¸Šç›¸æ¯”**TeleChat1**å‡æœ‰å¤§å¹…æå‡ã€‚
    - **TeleChat2**å®Œå…¨åŸºäºå›½äº§ç®—åŠ›å’Œå›½äº§æ·±åº¦å­¦ä¹ æ¡†æ¶è¿›è¡Œè®­ç»ƒï¼Œç®—åŠ›å’Œç®—æ³•æ¡†æ¶æ›´è‡ªä¸»å¯æ§ã€‚ä¼˜åŒ–MPã€PPã€SPå®ç°æ–¹å¼æå‡æ¨¡å‹æ€§èƒ½ï¼Œä¼˜åŒ–ç®—å­æ¥æå‡è®­ç»ƒé€Ÿåº¦ã€‚
    - æˆ‘ä»¬ä½¿ç”¨å¤§é‡å°æ¨¡å‹å®éªŒæ¥éªŒè¯scaling lawè§„å¾‹ï¼Œåœ¨ä¸åŒæ¨¡å‹ç»“æ„ã€ä¸åŒæ•°æ®é…æ¯”å’Œæ•°æ®æ¸…æ´—æ–¹å¼ä¸­å¯»æ‰¾æœ€ä¼˜è®¾è®¡ã€‚
    - é‡‡ç”¨RingAttentionåŠå…¶ä»–åºåˆ—åˆ‡åˆ†æ–¹å¼ï¼Œå®ç°é•¿æ–‡è®­ç»ƒæ€§èƒ½æå‡ï¼›é€šè¿‡ntk-aware+attention-scalingçš„æ–¹å¼ä¿è¯è®­ç»ƒé•¿åº¦åˆ‡æ¢æ—¶çš„å¹³ç¨³è¿‡æ¸¡ï¼Œä»¥æ­¤æ¥ä¿è¯æ¨¡å‹åœ¨ä¸åŒé•¿åº¦æ•°æ®ä¸‹çš„è®­ç»ƒæ•ˆæœã€‚
- åœ¨å¾®è°ƒæ•°æ®æ–¹é¢ï¼Œæˆ‘ä»¬è¿›è¡Œäº†æŒ‡ä»¤å¤æ‚æ€§æå‡ä¸å¤šæ ·æ€§æ‰©å……ï¼Œé€šè¿‡æ•°æ®åˆæˆå’Œäººå·¥æ ‡æ³¨ç”Ÿæˆé«˜è´¨é‡æ•°æ®ï¼Œå¹¶ä½¿ç”¨æ‹’ç»é‡‡æ ·ç”Ÿæˆå¤šæ ·çš„æ¨ç†è·¯å¾„ï¼›é€šè¿‡ç ”ç©¶ä¸€å¥—åŸºäºbaseæ¨¡å‹åå‘é€‰æ‹©åå¥½å¯¹é½æ•°æ®æ–¹æ¡ˆï¼ŒåŸºäºé€‚é…æ•°æ®æœ€å¤§é™åº¦æå‡æ¨¡å‹æ•ˆæœã€‚
    - é€šç”¨èƒ½åŠ›è¾ƒTeleChatç³»åˆ—æ¨¡å‹æå‡è¶…è¿‡29%ï¼Œåœ¨é€»è¾‘æ¨ç†ã€æ€»ç»“æ‘˜è¦ã€é•¿æ–‡å†™ä½œå’Œæ•°å­¦è®¡ç®—ä¸Šå‡æœ‰å¤§å¹…æå‡ã€‚

### æ¨¡å‹ç»“æ„

æˆ‘ä»¬é‡‡ç”¨æ ‡å‡†çš„ `Decoder-only` ç»“æ„è®¾è®¡äº† **TeleChat2** æ¨¡å‹ï¼Œä½¿ç”¨ [Rotary Embedding](https://arxiv.org/pdf/2104.09864.pdf)
çš„ä½ç½®ç¼–ç æ–¹æ³•ã€ä½¿ç”¨ [SwiGLU](https://arxiv.org/pdf/2002.05202.pdf)
æ¿€æ´»å‡½æ•°æ¥æ›¿ä»£GELUæ¿€æ´»å‡½æ•°ã€ä½¿ç”¨åŸºäº [RMSNorm](https://arxiv.org/abs/1910.07467) çš„ Pre-Normalizationè¿›è¡Œå±‚æ ‡å‡†åŒ–æ“ä½œã€‚æˆ‘ä»¬å°†**TeleChat2**çš„è¯åµŒå…¥å±‚å’Œè¾“å‡ºlm
headå±‚å‚æ•°åˆ†å¼€ï¼Œæœ‰åŠ©äºå¢å¼ºè®­ç»ƒç¨³å®šæ€§å’Œæ”¶æ•›æ€§ã€‚æˆ‘ä»¬é€‰æ‹©äº†GQAä»¥èŠ‚çº¦attentionéƒ¨åˆ†çš„å‚æ•°é‡å’Œè®¡ç®—é‡ã€æå‡è®­ç»ƒå’Œæ¨ç†é€Ÿåº¦ã€‚

**TeleChat2**çš„æ¨¡å‹ç»“æ„é…ç½®å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

|      | layer_num | hidden_size | ffn_hidden_size | head_num | tie_word_embeddings | GQA  |
| ---- | --------- | ----------- | --------------- | -------- | ------------------- | ---- |
| 115B | 96        | 8192        | 40960           | 64       | å¦                  | æ˜¯   |


æˆ‘ä»¬å¼€æºçš„TeleChatæ¨¡å‹ï¼š

- æ”¯æŒdeepspeedå¾®è°ƒï¼Œå¼€æºäº†åŸºäºdeepspeedçš„è®­ç»ƒä»£ç ï¼Œæ”¯æŒZeroå¹¶è¡Œæ˜¾å­˜ä¼˜åŒ–ï¼ŒåŒæ—¶é›†æˆäº†FlashAttention2
- å¤šè½®èƒ½åŠ›æ”¯æŒã€‚å¼€æºäº†å¤šè½®æ•°æ®æ„å»ºæ–¹å¼ï¼Œé’ˆå¯¹å¤šè½®æ¨¡å‹è®­ç»ƒé›†æˆäº†é’ˆå¯¹å¤šè½®çš„mask lossè®­ç»ƒæ–¹å¼ï¼Œæ›´å¥½çš„èšç„¦å¤šè½®ç­”æ¡ˆï¼Œæå‡é—®ç­”æ•ˆæœã€‚

æœ¬æ¬¡å‘å¸ƒç‰ˆæœ¬å’Œä¸‹è½½é“¾æ¥è§ä¸‹è¡¨

| æ¨¡å‹ç‰ˆæœ¬       | ä¸‹è½½é“¾æ¥ |
| -------------- | -------- |
| telechat2-115B-FP32 |   [modelscope](https://modelscope.cn/models/TeleAI/TeleChat2-115B)|

# æ•ˆæœè¯„æµ‹

TeleChatæ¨¡å‹ç›¸æ¯”åŒè§„æ¨¡æ¨¡å‹åœ¨è¯„æµ‹æ•ˆæœæ–¹é¢ä¹Ÿæœ‰è¾ƒå¥½çš„è¡¨ç°ï¼Œæˆ‘ä»¬çš„è¯„æµ‹é›†æ¶µç›–äº†åŒ…æ‹¬MMLUã€C-Evalã€CMMLUã€
GSM8Kã€MATHã€HumanEvalã€BBHç­‰æ•°æ®é›†ï¼Œè¯„æµ‹èƒ½åŠ›åŒ…æ‹¬äº†æŒ‡ä»¤éµå¾ªã€è€ƒè¯•èƒ½åŠ›ã€æ•°å­¦è®¡ç®—å’Œæ¨ç†ã€ä»£ç ç”Ÿæˆç­‰

## è¯„æµ‹é›†ä»‹ç»

### é€šç”¨èƒ½åŠ›

- MMLU æ•°æ®é›†æ˜¯ä¸€ä¸ªå…¨é¢çš„è‹±æ–‡è¯„æµ‹æ•°æ®é›†ï¼Œæ¶µç›–äº† 57 ä¸ªå­¦ç§‘ï¼ŒåŒ…æ‹¬äººæ–‡å­¦ç§‘ã€ç¤¾ä¼šç§‘å­¦ã€è‡ªç„¶ç§‘å­¦ã€åˆç­‰æ•°å­¦ã€ç¾å›½å†å²ã€è®¡ç®—æœºç§‘å­¦ã€æ³•å¾‹ç­‰ç­‰ã€‚

- CEVAL æ•°æ®é›†æ˜¯ä¸€ä¸ªå…¨é¢çš„ä¸­æ–‡è¯„ä¼°æµ‹è¯•é›†ï¼ŒåŒ…æ‹¬åˆä¸­ã€é«˜ä¸­ã€å¤§å­¦å’Œä¸“ä¸šéš¾åº¦çº§åˆ«çš„å¤šé¡¹é€‰æ‹©é¢˜ï¼Œæ¶µç›–äº† 52 ä¸ªä¸åŒçš„å­¦ç§‘é¢†åŸŸã€‚

- CMMLU æ•°æ®é›†åŒæ ·æ˜¯ä¸€ä¸ªå…¨é¢çš„ä¸­æ–‡è¯„ä¼°æµ‹è¯•é›†ï¼Œæ¶µç›–äº†ä»åŸºç¡€å­¦ç§‘åˆ°é«˜çº§ä¸“ä¸šæ°´å¹³çš„67ä¸ªä¸»é¢˜ã€‚

### æ¨ç†å’Œä»£ç èƒ½åŠ›

- GSM8K æ•°æ®é›†åŒ…å«äº†8.5Ké«˜è´¨é‡çš„å°å­¦æ•°å­¦é¢˜ï¼Œèƒ½å¤Ÿè¯„ä¼°è¯­è¨€æ¨¡å‹åœ¨æ•°å­¦æ¨ç†èƒ½åŠ›ä¸Šçš„è¡¨ç°ã€‚

- HumanEval æ•°æ®é›†æ˜¯ä¸€ä¸ªç”±openaiæä¾›çš„ä»£ç èƒ½åŠ›æµ‹è¯•æ•°æ®é›†ï¼Œå®ƒç”± 164 ä¸ªç¼–ç¨‹é—®é¢˜ç»„æˆï¼Œè¦æ±‚æ ¹æ®ç»™å®šçš„é—®é¢˜å’Œä»£ç æ¨¡æ¿ï¼Œç”Ÿæˆæ­£ç¡®çš„ä»£ç ç‰‡æ®µã€‚

	- BBH æ•°æ®é›†å…¨åä¸ºBIG-Bench Hardï¼ˆBBHï¼‰ï¼ŒåŒ…å«23ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„BIG-Benchä»»åŠ¡ï¼Œå‡ä¸ºä¹‹å‰çš„è¯­è¨€æ¨¡å‹è¯„ä¼°ä¸­æ²¡æœ‰è¶…è¿‡å¹³å‡äººç±»è¯„å®¡è€…è¡¨ç°çš„ä»»åŠ¡ã€‚

- MBPP æ•°æ®é›†åŒ…å«å¤§çº¦1000ä¸ªä¼—åŒ…çš„Pythonç¼–ç¨‹é—®é¢˜ï¼Œæ¶µç›–ç¼–ç¨‹åŸºç¡€çŸ¥è¯†ã€æ ‡å‡†åº“åŠŸèƒ½ç­‰ã€‚æ¯ä¸ªé—®é¢˜åŒ…æ‹¬ä»»åŠ¡æè¿°ã€ä»£ç è§£å†³æ–¹æ¡ˆå’Œ3ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ã€‚

### ä¸»è§‚é¢˜èƒ½åŠ›

- [AlignBench](https://github.com/THUDM/AlignBench)æ˜¯ä¸€ä¸ªå¤šç»´åº¦å…¨é¢è¯„ä¼°ä¸­æ–‡å¤§æ¨¡å‹å¯¹é½æ°´å¹³çš„è¯„æµ‹åŸºå‡†ï¼ŒåŒ…å«638é“å•è½®ä¸»è§‚è¯„æµ‹é¢˜ã€‚

- [MT-bench](https://github.com/lm-sys/FastChat/blob/main/fastchat/llm_judge/README.md)æ˜¯ä¸€ä¸ªç”¨äºè¯„ä¼°èŠå¤©åŠ©æ‰‹çš„å…·æœ‰æŒ‘æˆ˜æ€§çš„å¤šè½®å¼€æ”¾å¼é—®é¢˜é›†ï¼ŒåŒ…å«80é€šå¤šè½®ä¸»è§‚è¯„æµ‹é¢˜ã€‚

### æŒ‡ä»¤éµå¾ªèƒ½åŠ›

- [IFEval](https://github.com/EleutherAI/lm-evaluation-harness/blob/main/lm_eval/tasks/ifeval/README.md)æ—¨åœ¨è¯„ä¼°è¯­è¨€æ¨¡å‹å¯¹æŒ‡ä»¤çš„ç²¾ç¡®éµå¾ªèƒ½åŠ›ï¼Œå®ƒåŒ…å«äº†500æ¡å¯ç²¾ç¡®éªŒè¯çš„æŒ‡ä»¤ï¼Œæ˜¯Open
  LLM Leaderboardä¸­ä½¿ç”¨çš„æ ¸å¿ƒåŸºå‡†æµ‹è¯•ä¹‹ä¸€ã€‚

## è¯„æµ‹ç»“æœå¦‚ä¸‹

| Dataset    | Llama-3.1-70B | Qwen1.5-110B | Qwen2-72-instruct | DeepSeek-v2 | TeleChat2-115B |
|:----------:|:-------------:|:------------:|:-----------------:|:-----------:|:--------------:|
| C-Eval     | -             | -            | 83.8              | 78          | **86.9**       |
| MMLU       | **86**        | 80.4         | 82.3              | 77.8        | 80.9           |
| CMMLU      | 69.01         | 87.64        | 87.47             | 81.6        | **89.94**      |
| GSM8K      | **95.1**      | 85.4         | 91.1              | 92.2        | 92.2           |
| HumanEval  | 80.5          | 52.4         |**86**               | 81.1        | 75             |
| BBH        | -             | 74.8         | -                 | 79.7        | **89.04**      |
| MBPP       | **86**        | 58.1         | 80.2              | 72          | 78             |
| AlignBench | -             | 7.86         | **8.27**          | 7.91        | 8.03           |
| MT-bench   | 8.79          | 8.88         | **9.12**          | 8.97        | 8.89           |
| IFEval     | **87.5**      | -            | 77.6              | 63.8        | 82.81          |

# æ¨¡å‹æ¨ç†å’Œéƒ¨ç½²

### æ¨¡å‹æ¨ç†

å½“å‰æ¨¡å‹æ¨ç†å…¼å®¹äº†å•å¡å’Œå¤šå¡æ¨ç†ï¼Œä»¥åŠé’ˆå¯¹é•¿æ–‡æ¨ç†åšäº†éƒ¨åˆ†ä¼˜åŒ–å·¥ä½œã€‚

**æ¨¡å‹æ¨ç†æ–¹æ³•ç¤ºèŒƒ**

```python
>> > import os
>> > import torch
>> > from transformers import AutoModelForCausalLM, AutoTokenizer, GenerationConfig
>> > tokenizer = AutoTokenizer.from_pretrained('../models/115B', trust_remote_code=True)
>> > model = AutoModelForCausalLM.from_pretrained('../models/115B', trust_remote_code=True, device_map="auto",
                                                  torch_dtype=torch.float16)
>> > generate_config = GenerationConfig.from_pretrained('../models/115B')
>> > question = "ç”ŸæŠ½ä¸è€æŠ½çš„åŒºåˆ«ï¼Ÿ"
>> > answer, history = model.chat(tokenizer=tokenizer, question=question, history=[], generation_config=generate_config,
                                  stream=False)
>> > print(answer)
ç”ŸæŠ½å’Œè€æŠ½æ˜¯ä¸¤ç§ä¸åŒçš„é…±æ²¹ï¼Œå®ƒä»¬åœ¨é£å‘³ã€è‰²æ³½å’Œç”¨é€”ä¸Šéƒ½æœ‰æ‰€åŒºåˆ«ã€‚

1.é¢œè‰²ï¼šç”ŸæŠ½çš„é¢œè‰²æ¯”è¾ƒæ·¡ï¼Œè€Œè€æŠ½çš„é¢œè‰²è¾ƒæ·±ã€‚ç”ŸæŠ½çš„é¢œè‰²å‘ˆçº¢è¤è‰²æˆ–æ£•çº¢è‰²ï¼Œè€Œè€æŠ½çš„é¢œè‰²åˆ™å‘ˆæ£•é»‘è‰²ã€‚

2.å‘³é“ï¼šç”ŸæŠ½å…·æœ‰é²œç¾çš„å’¸å‘³å’Œå¾®ç”œçš„å‘³æµ…ï¼Œè€Œè€æŠ½æµ“éƒï¼Œé¢œè‰²è¾ƒæ·±ã€‚æ ¹æ®ä¸ªäººå£å‘³å’Œçƒ¹é¥ªéœ€æ±‚é€‰æ‹©ä¸åŒçš„é…±æ²¹ç±»å‹å¯ä»¥è·å¾—æ›´å¥½çš„å£æ„Ÿå’Œèœè‚´æ•ˆæœã€‚
```

### æ¨¡å‹éƒ¨ç½²

TeleChatç›®å‰æä¾›äº†APIã€Webä¸¤ç§éƒ¨ç½²æ–¹å¼ã€‚ç›®å‰ä»…æä¾›ç®€å•çš„å•å¡å•å¹¶å‘åœºæ™¯ï¼Œç”¨äºæ¼”ç¤ºå’Œæ•ˆæœæµ‹è¯•ã€‚

API: åˆ†ä¸ºæµå¼æ¥å£å’Œjsonæ¥å£ï¼Œæ”¯æŒä¼ å…¥æ¨ç†å‚æ•°

Web: æ”¯æŒæµå¼ç”Ÿæˆã€å¤šè½®å¯¹è¯

[ç°å·²æ”¯æŒvllmæ¨ç†](./vllm_inf)

# æ¨¡å‹å¾®è°ƒ

## æ•°æ®å¤„ç†

ä¸ºäº†æ–¹ä¾¿æ•°æ®é…æ¯”ï¼Œè§£è€¦äº†æ•°æ®å¤„ç†å’Œæ¨¡å‹è®­ç»ƒï¼Œæ•°æ®æƒé‡é…æ¯”æ–‡ä»¶å¦‚**data.json**æ‰€ç¤ºï¼Œjsonå­—å…¸ä¸­keyä¸ºè¯»å–æ•°æ®çš„è·¯å¾„ï¼Œvalueä¸ºè®­ç»ƒæ—¶æ•°æ®çš„æƒé‡ã€‚å•è½®ã€å¤šè½®æ•°æ®æ ¼å¼å¦‚æ ·ä¾‹æ•°æ®æ‰€ç¤º

```shell
{
  "datas/single_turn_example.jsonl": 2.0,
  "datas/multi_turn_example.jsonl": 1.0
}
```

è¿è¡Œ**process_data.py**å³å¯å°†æ–‡ä»¶å¤„ç†æˆtokensï¼Œå¹¶ä¿å­˜ã€‚å…¶ä¸­**data_output_path/train_data_{i}.pt**ä¿å­˜å¤„ç†åçš„æ–‡ä»¶ï¼Œ**içš„èŒƒå›´æ˜¯0~num_workers**
ã€‚è®­ç»ƒæ—¶ä¼šåŠ è½½è·¯å¾„ä¸‹æ‰€æœ‰**train_data_{i}.pt**æ–‡ä»¶

* æ•°æ®é€šè¿‡**data_path**è¯»å–ï¼Œæœ€ç»ˆæ‹¼æ¥ç”Ÿæˆ**num_samples**ä¸ª**max_seq_len**é•¿åº¦çš„sampleè¿›è¡Œè®­ç»ƒã€‚å¦‚æ ·ä¾‹æ‰€ç¤ºï¼Œå‡è®¾**datas/single_turn_example.jsonl**å’Œ**
  datas/multi_turn_example.jsonl**
	  å„æœ‰1000æ¡samplesï¼Œé…æ¯”è¿‡åæ•°æ®æ± ä¸­åˆ™æ€»å…±åŒ…å«3000æ¡samplesã€‚åœ¨æ•°æ®æ‹¼æ¥è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¼šä¸æ–­éå†æ•°æ®æ± ï¼Œå°½å¯èƒ½å°†æ•°æ®æ‹¼æ¥åˆ°4096é•¿åº¦ï¼ˆä¸å¤Ÿå°±å·¦paddingï¼‰ï¼Œç›´è‡³ç”Ÿæˆåˆ°num_samplesçš„ä¸ªæ•°ã€‚å› æ­¤ï¼Œæ¯ä¸ªsampleä¸­ä¼šåŒ…å«å¤šæ¡æ‹¼æ¥è€Œæˆçš„æ•°æ®ã€‚
* process_methodé€‰æ‹©**single**æˆ–**multiple**å•è¿›ç¨‹æˆ–å¤šè¿›ç¨‹å¤„ç†æ•°æ®ã€‚

```python
python3 -u process_data.py \
   --data_path data.json \ # æ•°æ®é…æ¯”æ–‡ä»¶è·¯å¾„
   --tokenizer_path ../../models/12B \ # æ¨¡å‹/tokenzierè·¯å¾„
   --data_output_path $DATA_OUTPUT_PATH \ # å¤„ç†åæ•°æ®ä¿å­˜åœ°å€
   --max_seq_len $MAX_LEN \ # æ•°æ®é•¿åº¦
   --num_samples $NUM_SAMPLES \ # æœ€ç»ˆç”Ÿæˆæ‹¼æ¥åçš„æ•°æ®æ•°é‡
   --num_workers 10 \ # å¤šè¿›ç¨‹ä¸ªæ•°
   --process_method multiple \ # å¤šè¿›ç¨‹&å•è¿›ç¨‹å¤„ç†
   --seed 42
```

## å…¨å‚è®­ç»ƒ

```shell
deepspeed --master_port 29500 --hostfile=my_hostfile main.py \
   --data_path $DATA_OUTPUT_PATH \ # tokenzieåçš„æ•°æ®æ–‡ä»¶å­˜æ”¾åœ°å€
   --model_name_or_path $model_path \
   --with_loss_mask \
   --per_device_train_batch_size 1 \
   --max_seq_len 4096 \
   --learning_rate 3e-5 \
   --weight_decay 0.0001 \
   --num_train_epochs 1 \
   --gradient_accumulation_steps 4 \
   --lr_scheduler_type cosine \
   --precision fp16 \ # è®­ç»ƒç²¾åº¦ï¼Œfp16æˆ–bf16
   --warmup_proportion 0.1 \ 
   --gradient_checkpointing \
   --offload \
   --seed 1233 \
   --zero_stage $ZERO_STAGE \ 
   --save_steps 10 \
   --deepspeed \ 
   --output_dir $OUTPUT # è¾“å‡ºè·¯å¾„ 
```

# å›½äº§åŒ–é€‚é…

### æ˜‡è…¾Atlas 800T A2è®­ç»ƒæœåŠ¡å™¨+æ˜‡æ€MindSporeæ¡†æ¶:  è®­ç»ƒã€æ¨ç†é€‚é…

å½“å‰æ˜Ÿè¾°è¯­ä¹‰å¤§æ¨¡å‹TeleChat2æ”¯æŒæ˜‡è…¾Atlas 800T A2è®­ç»ƒæœåŠ¡å™¨ï¼Œå¯åŸºäºæ˜‡æ€MindSporeæ¡†æ¶è¿›è¡Œæ¨¡å‹è®­ç»ƒå’Œè¯„æµ‹ã€‚

- æ€§èƒ½æ–¹é¢ï¼Œå…·ä½“å¯¹æ¯”å¦‚ä¸‹ï¼š
-
| NAME                 | performance(samples/p/s) | Epochs | AMP_Type |
  |--------------------------| ---------------------: | ------ | -------: |
| 115B  |  0.0192            | 1      |        O1 |
| 115B           | 0.0174                | 1      |       O2 |

	è¯´æ˜ï¼šå»ºè®®é‡‡ç”¨8å°ä¸€ç»„è¿›è¡Œè®­ç»ƒ

- TeleChatæ”¯æŒæ˜‡è…¾Atlas 800T A2è®­ç»ƒæœåŠ¡å™¨ï¼Œå¯åŸºäºæ˜‡æ€MindSporeæ¡†æ¶è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œè®­ç»ƒæ‰€éœ€çš„modelingã€READMEã€
  è„šæœ¬å·²å‘å¸ƒï¼š[TeleChat-MindSpore](https://gitee.com/mindspore/mindformers/tree/dev/research/telechat)

# å£°æ˜ã€åè®®ã€å¼•ç”¨

### å£°æ˜

æˆ‘ä»¬åœ¨æ­¤å£°æ˜ï¼Œä¸è¦ä½¿ç”¨TeleChatæ¨¡å‹åŠå…¶è¡ç”Ÿæ¨¡å‹è¿›è¡Œä»»ä½•å±å®³å›½å®¶ç¤¾ä¼šå®‰å…¨æˆ–è¿æ³•çš„æ´»åŠ¨ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ±‚ä½¿ç”¨è€…ä¸è¦å°†TeleChatæ¨¡å‹ç”¨äºæ²¡æœ‰å®‰å…¨å®¡æŸ¥å’Œå¤‡æ¡ˆçš„äº’è”ç½‘æœåŠ¡ã€‚æˆ‘ä»¬å¸Œæœ›æ‰€æœ‰ä½¿ç”¨è€…éµå®ˆä¸Šè¿°åŸåˆ™ï¼Œç¡®ä¿ç§‘æŠ€å‘å±•åœ¨åˆæ³•åˆè§„çš„ç¯å¢ƒä¸‹è¿›è¡Œã€‚

æˆ‘ä»¬å·²ç»å°½æˆ‘ä»¬æ‰€èƒ½ï¼Œæ¥ç¡®ä¿æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ®çš„åˆè§„æ€§ã€‚ç„¶è€Œï¼Œå°½ç®¡æˆ‘ä»¬å·²ç»åšå‡ºäº†å·¨å¤§çš„åŠªåŠ›ï¼Œä½†ç”±äºæ¨¡å‹å’Œæ•°æ®çš„å¤æ‚æ€§ï¼Œä»æœ‰å¯èƒ½å­˜åœ¨ä¸€äº›æ— æ³•é¢„è§çš„é—®é¢˜ã€‚å› æ­¤ï¼Œå¦‚æœç”±äºä½¿ç”¨TeleChatå¼€æºæ¨¡å‹è€Œå¯¼è‡´çš„ä»»ä½•é—®é¢˜ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ•°æ®å®‰å…¨é—®é¢˜ã€å…¬å…±èˆ†è®ºé£é™©ï¼Œæˆ–æ¨¡å‹è¢«è¯¯å¯¼ã€æ»¥ç”¨ã€ä¼ æ’­æˆ–ä¸å½“åˆ©ç”¨æ‰€å¸¦æ¥çš„ä»»ä½•é£é™©å’Œé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚

### åè®®

ç¤¾åŒºä½¿ç”¨ TeleChat æ¨¡å‹éœ€è¦éµå¾ªã€Š[TeleChatæ¨¡å‹ç¤¾åŒºè®¸å¯åè®®](./TeleChatæ¨¡å‹ç¤¾åŒºè®¸å¯åè®®.pdf)ã€‹ã€‚TeleChatæ¨¡å‹æ”¯æŒå•†ä¸šç”¨é€”ï¼Œå¦‚æœæ‚¨è®¡åˆ’å°† TeleChat
æ¨¡å‹æˆ–å…¶è¡ç”Ÿå“ç”¨äºå•†ä¸šç›®çš„ï¼Œæ‚¨éœ€è¦é€šè¿‡ä»¥ä¸‹è”ç³»é‚®ç®±
tele_ai@chinatelecom.cnï¼Œæäº¤ã€ŠTeleChatæ¨¡å‹ç¤¾åŒºè®¸å¯åè®®ã€‹è¦æ±‚çš„ç”³è¯·ææ–™ã€‚å®¡æ ¸é€šè¿‡åï¼Œå°†ç‰¹æ­¤æˆäºˆæ‚¨ä¸€ä¸ªéæ’ä»–æ€§ã€å…¨çƒæ€§ã€ä¸å¯è½¬è®©ã€ä¸å¯å†è®¸å¯ã€å¯æ’¤é”€çš„å•†ç”¨ç‰ˆæƒè®¸å¯ã€‚

### å¼•ç”¨

å¦‚éœ€å¼•ç”¨æˆ‘ä»¬çš„å·¥ä½œï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹ reference:

```
@misc{wang2024telechat,
      title={TeleChat Technical Report}, 
      author={Zihan Wang and Xinzhang Liu and Shixuan Liu and Yitong Yao and Yuyao Huang and Zhongjiang He and Xuelong Li and Yongxiang Li and Zhonghao Che and Zhaoxi Zhang and Yan Wang and Xin Wang and Luwen Pu and Huihan Xu and Ruiyu Fang and Yu Zhao and Jie Zhang and Xiaomeng Huang and Zhilong Lu and Jiaxin Peng and Wenjun Zheng and Shiquan Wang and Bingkai Yang and Xuewei he and Zhuoru Jiang and Qiyi Xie and Yanhan Zhang and Zhongqiu Li and Lingling Shi and Weiwei Fu and Yin Zhang and Zilu Huang and Sishi Xiong and Yuxiang Zhang and Chao Wang and Shuangyong Song},
      year={2024},
      eprint={2401.03804},
      archivePrefix={arXiv},
      primaryClass={cs.CL}
}
```
